<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Login - Sistema de Compras</title>
    <link rel="stylesheet" href="vistas/css/styles.css" />
    <style>
      .password-container {
        position: relative;
        display: flex;
        align-items: center;
      }
      .toggle-password {
        position: absolute;
        right: 10px;
        cursor: pointer;
        font-size: 0.8em;
        color: #666;
        user-select: none;
      }
      .toggle-password:hover {
        color: #333;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Iniciar Sesión</h2>

      <form onsubmit="return validarLogin();" novalidate>
        <div class="form-group">
          <label for="txt_usuario">Usuario </label>
          <input
            type="text"
            id="txt_usuario"
            name="usuario"
            maxlength="10"
            placeholder="Ingrese su cédula"
            required
          />
          <div id="error_usuario" class="error-msg"></div>
        </div>

        <div class="form-group">
          <label for="txt_password">Contraseña</label>
          <div class="password-container">
            <input
              type="password"
              id="txt_password"
              name="password"
              placeholder="Ingrese su contraseña"
              required
            />
            <span class="toggle-password" onclick="verPassword()">Mostrar</span>
          </div>
          <div id="error_password" class="error-msg"></div>
        </div>

        <button class="btn-guardar" type="submit">Ingresar</button>
      </form>
    </div>

    <script src="vistas/js/validaciones.js"></script>

    <script>
      function validarLogin() {
        limpiarErrores();
        let esValido = true;

        const usuario = document.getElementById("txt_usuario").value.trim();
        const password = document.getElementById("txt_password").value.trim();

        // 1. VALIDAR USUARIO (Cédula)
        if (esVacio(usuario)) {
          mostrarError(
            "txt_usuario",
            "error_usuario",
            "El usuario es obligatorio.",
          );
          esValido = false;

        } else if (!esCedulaEcuatoriana(usuario)) {
          mostrarError(
            "txt_usuario",
            "error_usuario",
            "Ingrese una cédula válida.",
          );
          esValido = false;
        }

        // 2. VALIDAR CONTRASEÑA
        if (esVacio(password)) {
          mostrarError(
            "txt_password",
            "error_password",
            "La contraseña es obligatoria.",
          );
          esValido = false;
          
        } else if (!cumpleLongitudMinima(password, 6)) {
          mostrarError(
            "txt_password",
            "error_password",
            "Contraseña incorrecta (mínimo 6 caracteres).",
          );
          esValido = false;
        }

        if (esValido) {
          window.location.href = "./vistas/formularios/menu_principal.html";
        }

        return false;
      }

      function verPassword() {
        const input = document.getElementById("txt_password");
        const texto = document.querySelector(".toggle-password");

        if (input.type === "password") {
          input.type = "text";
          texto.textContent = "Ocultar";
        } else {
          input.type = "password";
          texto.textContent = "Mostrar";
        }
      }
    </script>
  </body>
</html>
